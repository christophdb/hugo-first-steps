{{ define "main" }}
    <section class="padding max-container mt-4">
        <div class="text-center">
            <!-- Headline -->
            <h1 class="mb-8 text-4xl">{{ .Params.headline }}</h1>

            <!-- Search -->
            <link href="/pagefind/pagefind-ui.css" rel="stylesheet" />
            <script src="/pagefind/pagefind-ui.js"></script>
            <div id="search" class="mx-auto max-w-2xl text-left"></div>
            <script>
                window.addEventListener('DOMContentLoaded', (event) => {
                    new PagefindUI({ 
                        element: '#search', 
                        showImages: false, 
                        showSubResults: true 
                    });

                    // Wait for Pagefind UI to create the input
                    const attachUmamiSearchTracking = () => {
                        const input = document.querySelector('#search input[type="search"], #search input');
                        if (!input) {
                            setTimeout(attachUmamiSearchTracking, 100);
                            return;
                        }

                        let lastTerm = '';
                        let timeoutId = null;

                        const trackSearch = (term) => {
                            if (!term || !window.umami) {
                                return;
                            }
                            try {
                                window.umami.track('Help Search', { query: term });
                                console.log('Umami Suche getrackt:', term);
                                console.log('Umami Event gesendet!');
                            } catch (e) {
                                console.error('Umami Fehler:', e);
                            }
                        };

                        // Robust: Lausche auf input-Änderungen (jedes Tippen)
                        const observer = new MutationObserver(() => {
                            const currentValue = input.value.trim();
                            if (currentValue !== lastTerm) {
                                lastTerm = currentValue;
                                clearTimeout(timeoutId);
                                timeoutId = setTimeout(() => {
                                    console.log('DEBOUNCED trackSearch mit term:', lastTerm);
                                    trackSearch(lastTerm);
                                }, 500); // 500ms nach letztem Tippen
                            }
                        });

                        observer.observe(input, { attributes: false, childList: false, subtree: false, characterData: true });

                        // Auch change als Fallback
                        input.addEventListener('change', (e) => {
                            console.log('change-Event (Fallback)');
                            trackSearch(e.target.value.trim());
                        });
                    };

                    attachUmamiSearchTracking();
                });
            </script>
        </div>

        <!-- Help categories -->
        <div class="mx-auto my-12 grid max-w-4xl auto-rows-fr grid-cols-2 gap-4 md:grid-cols-3 lg:grid-cols-4">
            {{ range .Sections }}
                {{ $bgClass := .Params.color | default "bg-red-100" }}
                <a href="{{ .RelPermalink }}">
                    <div class="flex h-full flex-col rounded-xl">
                        <div class="{{ $bgClass }} flex w-full justify-center rounded-t-xl border p-4 text-3xl text-seatable-gray">
                            {{ partial "icon.html" .Params.icon .Params.icon }}
                        </div>
                        <span class="text-md h-full rounded-b-xl border px-4 pb-8 pt-6 text-center font-poppins text-seatable-gray">{{ .Title }}</span>
                    </div>
                </a>
            {{ end }}
        </div>
    </section>

    <!-- More information -->
    <section class="curved padding relative bg-seatable-blue">
        <section class="max-container">
            <div class="mx-auto mb-12 max-w-3xl text-center">
                <p class="gradient font-poppins text-2xl font-bold">{{ .Params.info_sources.subtitle }}</p>
                <h2 class="mt-1 text-4xl font-bold text-white">{{ .Params.info_sources.title }}</h2>
                <p>&nbsp;</p>
            </div>

            
            <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">

                {{ range .Params.sources }}
                    {{ $link := .link }}
                    {{ if not (or (hasPrefix $link "http://") (hasPrefix $link "https://")) }}
                        {{ with $.Site.GetPage $link }}
                            {{ $link = .RelPermalink }}
                        {{ end }}
                    {{ end }}

                    <div class="flex flex-col rounded-md bg-gray-100 p-8">
                        <span class="text-3xl text-seatable-orange">{{ partial "icon.html" .icon }}</span>
                        <h3 class="mt-3 text-2xl font-bold">{{ .title }}</h3>
                        <p class="mb-8 mt-4">{{ .text | markdownify }}</p>
                        <a class="mt-auto flex items-center gap-1 font-bold text-blue-500" href="{{ $link }}">{{ .link_text}} {{ partial "icon.html" "arrow-top-right" }}</a>
                    </div>
                {{ end }}

            </div>
        </section>
    </section>

    <!-- Customer feedback and contact -->
    <section class="max-container padding relative">
        <div class="mx-auto max-w-xl text-center">
            <h2 class="mt-1 text-3xl font-bold">{{ .Params.customer_feedback.title }}</h2>
            <p class="mt-4 text-lg leading-relaxed">{{ .Params.customer_feedback.text }}</p>
            <div class="mt-8 text-center">
                <a class="bg-gradient rounded-xl px-5 py-2 font-poppins text-lg font-bold text-white" href="{{ relref . "/pages/contact" }}">{{ .Params.customer_feedback.contact_us }}</a>
            </div>
        </div>

        <div class="max-container mb-24 mt-24 flex flex-row gap-4 items-start">
            {{ $bgColors := slice "bg-orange-100" "bg-sky-100" "bg-green-100" "bg-red-50" "bg-blue-50" "bg-orange-50" "bg-lime-50"}}
            {{ range $i, $customer := .Params.customers }}

                {{ if eq (mod $i 2) 0 }}
                <div class="flex flex-1 flex-col gap-4">
                {{ end }}
                    <div class="rounded-xl border border-gray-300 {{ index $bgColors $i }} p-6 pr-10 -indent-1 shadow-lg {{ if eq (mod $i 4) 0 }} -mt-4 {{ end }}">
                        <p class="text-base leading-normal">„{{ $customer.comment | markdownify }}“</p>
                        <div class="pt-8 text-base gradient pl-1 font-bold font-poppins">{{ $customer.name }}</div>
                    </div>
                
                {{ if eq (mod $i 2) 1 }}
                </div>
                {{ end }}
            {{ end }}
        </div>
    </section>

    <!--
    <section class="curved relative bg-gray-100">
        <section class="max-container pt-20">
            <p class="gradient font-poppins text-2xl font-bold">Nicht das richtige gefunden?</p>
            <h2 class="mt-1 text-4xl font-bold">Weitere Informationsquellen</h2>
            <div class="mx-auto mt-12 grid grid-cols-1 gap-40 lg:grid-cols-2 xl:grid-cols-3">
                <div class=" ">
                    <span class="text-center text-3xl text-seatable-orange">{{ partial "icon.html" "ghost" }}</span>
                    <h3 class="mt-3 text-2xl font-bold">Community Forum</h3>
                    <p class="mb-8 mt-4 text-lg leading-normal">Tauschen Sie sich mit anderen Nutzern aus, um Fragen über SeaTable zu stellen und zu beantworten.</p>
                    <a href="#" class="text-blue-600">Zum Forum</a>
                </div>
                <div class=" ">
                    <span class="text-center text-3xl text-seatable-orange">{{ partial "icon.html" "ghost" }}</span>
                    <h3 class="mt-3 text-2xl font-bold">Kurzanleitung</h3>
                    <p class="mb-8 mt-4 text-lg leading-normal">Wissen Sie nicht, wo Sie anfangen sollen? Unsere Kurzanleitung wird Ihnen helfen.</p>
                    <a href="#" class="text-blue-600">Loslegen</a>
                </div>
                <div class="">
                    <span class="text-center text-3xl text-seatable-orange">{{ partial "icon.html" "ghost" }}</span>
                    <h3 class="mt-3 text-2xl font-bold">Vorlagen</h3>
                    <p class="mb-8 mt-4 text-lg leading-normal">Erfinden Sie das Rad nicht neu. SeaTable bietet Vorlagen für fast jede Herausforderung.</p>
                    <a href="#" class="text-blue-600">Vorlagen erkunden</a>
                </div>
            </div>
        </section>
    </section>
    -->

    <!--
        <section class="max-container">
            <div class="mx-auto max-w-xl text-center">
                <h2 class="mt-1 text-3xl font-bold">Echte Menschen, die für dich da sind</h2>
                <p class="mt-4 text-lg leading-relaxed">
                    98 von 100 Personen finden die Antworten, die sie brauchen, in einem unserer Hilfeartikel. Wenn du zu den verbleibenden 2 % gehörst, steht dir unser
                    Expertenteam zur Verfügung.
                </p>
                <div class="mt-8 text-center">
                    <a class="bg-gradient text-md rounded-xl px-5 py-2 font-poppins font-bold text-white" href="#">Kontaktiere uns</a>
                </div>
            </div>

            <div class="max-container mb-24 mt-24 grid grid-cols-1 gap-2 lg:grid-cols-2 xl:grid-cols-3">
                <div class="rounded-xl border p-6 pr-10">
                    <p class="text-lg leading-normal">
                        „Stacey war fantastisch – sie war äußerst hilfsbereit und hat unermüdlich daran gearbeitet, mein Problem zu lösen. Ich schätze ihre Unterstützung wirklich
                        sehr.“
                    </p>
                </div>
                <div class="rounded-xl border p-6 pr-10">
                    <p class="text-lg leading-normal">
                        „Direkt auf den Punkt gebracht und wirklich schnell geantwortet. Alles gut erklärt und das Problem gelöst. Was will man mehr?“
                    </p>
                </div>
                <div class="rounded-xl border p-6 pr-10">
                    <p class="text-lg leading-normal">
                        „In Zeiten, in denen Bots oft die erste und sogar zweite Ebene des Supports bei den meisten Dienstleistungsunternehmen darstellen, war es eine willkommene
                        Erfahrung, mit einer echten Person zu sprechen. Die Interaktion mit Stephanie war besonders erfrischend und ermutigend, da sie mir das Gefühl gab, dass die
                        Kundschaft Todoist wirklich am Herzen liegt.“
                    </p>
                </div>
            </div>
        </section>
    </section>
    -->

    <!--
        <div class="my-12">Noch ganz viele andere Hilfequellen...</div>
        <ul>
            <li>Was gibt es neues?</li>
            <li>Kurzanleitung</li>
            <li>Kundenstimmen</li>
            <li>Vorlagen</li>
            <li>Andere Dokumenttionen</li>
        </ul>
        -->
{{ end }}
